<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Permissions-Policy" content="microphone=*, camera=*">
    <meta name="theme-color" content="#667eea">
    <title>ShikshaLite</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Comic Neue', cursive;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }
        
        h1 {
            font-family: 'Fredoka One', cursive;
            font-size: 4rem;
            text-align: center;
            color: #fff;
            text-shadow: 3px 3px 0px #ff6b6b, 6px 6px 0px #4ecdc4;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .description {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(255,255,255,0.9);
            padding: 30px;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: slideIn 1s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .description h2 {
            font-family: 'Fredoka One', cursive;
            color: #ff6b6b;
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        
        .description p {
            font-size: 1.3rem;
            color: #555;
            font-weight: 700;
        }
        
        .game-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .game-card {
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            border-radius: 25px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .game-card:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
            border-color: #ff6b6b;
        }
        
        .game-icon {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .game-card h3 {
            font-family: 'Fredoka One', cursive;
            font-size: 2rem;
            color: #333;
            margin-bottom: 15px;
        }
        
        .game-card p {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 20px;
            font-weight: 700;
        }
        
        .game-features {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        
        .game-features span {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .control-btn {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(255,107,107,0.3);
            font-family: 'Comic Neue', cursive;
        }
        
        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(255,107,107,0.4);
        }
        
        .back-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Comic Neue', cursive;
            margin-bottom: 20px;
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102,126,234,0.3);
        }
        
        .game-container-inner {
            background: rgba(255,255,255,0.95);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
            animation: slideIn 0.5s ease-out;
            display: none;
        }
        
        .feedback .success {
            color: #27ae60;
            font-size: 1.5rem;
            font-weight: bold;
            animation: celebrate 0.5s ease-in-out;
        }
        
        @keyframes celebrate {
            0% { transform: scale(0.8); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .feedback .error {
            color: #e74c3c;
            font-size: 1.3rem;
            font-weight: bold;
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            background: rgba(255,255,255,0.9);
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .footer p {
            font-size: 1.2rem;
            color: #333;
            font-weight: bold;
        }
        
        /* Color Game Styles */
        .color-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 30px 0;
            justify-items: center;
        }
        
        .color-btn {
            width: 100px;
            height: 100px;
            border: 4px solid white;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        .color-btn:hover {
            transform: scale(1.2);
            box-shadow: 0 12px 35px rgba(0,0,0,0.3);
        }
        
        #shape-display {
            margin: 20px auto;
            animation: shapeFloat 3s ease-in-out infinite;
        }
        
        @keyframes shapeFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }
        
        /* Memory Game Styles */
        .counting-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            padding: 20px;
            background: rgba(255,255,255,0.8);
            border-radius: 15px;
            border: 3px solid #4ecdc4;
        }
        
        .counting-object {
            width: 80px;
            height: 80px;
            margin: 10px;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
            transition: transform 0.3s ease;
        }
        
        .counting-object:hover {
            transform: scale(1.1);
        }
        
        .option-btn {
            padding: 15px 20px;
            font-size: 1.2rem;
            border: 3px solid #4ecdc4;
            background: white;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            font-family: 'Comic Neue', cursive;
            font-weight: bold;
        }
        
        .option-btn:hover {
            background: #4ecdc4;
            color: white;
            transform: scale(1.05);
        }
        
        /* Gesture Game Styles */
        .camera-container {
            position: relative;
            max-width: 640px;
            margin: 0 auto 20px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        #camera-feed {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .camera-status {
            background: rgba(255,255,255,0.9);
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            color: #333;
        }
        
        .gesture-display {
            text-align: center;
            margin: 20px 0;
        }
        
        #gesture-icon {
            font-size: 6rem;
            animation: float 2s ease-in-out infinite;
        }
        
        .progress-bar {
            background: #f0f0f0;
            border-radius: 15px;
            height: 20px;
            overflow: hidden;
            margin: 20px 0;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }
        
        #progress-fill {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            height: 100%;
            border-radius: 15px;
            transition: width 0.5s ease;
        }
        
        /* Animal Game Styles */
        .animal-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .animal-btn {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 20px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(78,205,196,0.3);
            font-family: 'Comic Neue', cursive;
        }
        
        .animal-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(78,205,196,0.4);
        }
        
        #animal-icon {
            font-size: 4rem;
            margin: 20px 0;
            animation: float 2s ease-in-out infinite;
        }
        
        /* Voice Status */
        .voice-status {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: rgba(102,126,234,0.1);
            border-radius: 15px;
            border: 2px solid #667eea;
        }
        
        .voice-status p {
            font-weight: bold;
            color: #667eea;
            margin: 0;
        }
        
        /* Floating shapes */
        .floating-shapes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .shape {
            position: absolute;
            font-size: 2rem;
            animation: float-around 15s infinite linear;
            opacity: 0.7;
        }
        
        .shape1 {
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }
        
        .shape2 {
            top: 20%;
            right: 15%;
            animation-delay: 3s;
        }
        
        .shape3 {
            bottom: 30%;
            left: 20%;
            animation-delay: 6s;
        }
        
        .shape4 {
            bottom: 20%;
            right: 10%;
            animation-delay: 9s;
        }
        
        .shape5 {
            top: 50%;
            left: 50%;
            animation-delay: 12s;
        }
        
        @keyframes float-around {
            0% {
                transform: translateY(0px) rotate(0deg);
            }
            25% {
                transform: translateY(-20px) rotate(90deg);
            }
            50% {
                transform: translateY(0px) rotate(180deg);
            }
            75% {
                transform: translateY(20px) rotate(270deg);
            }
            100% {
                transform: translateY(0px) rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>üéÆ ShikshaLite üéÆ</h1>
        
        <div class="description">
            <h2>üåü Inclusive Learning Games for All Children üåü</h2>
            <p>Voice-controlled educational games designed for children with physical, and cognitive disabilities.</p>
        </div>
        
        <!-- Scores Dashboard -->
        <div class="scores-dashboard" style="background: rgba(255,255,255,0.9); padding: 20px; border-radius: 20px; margin-bottom: 30px; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
            <h3 style="text-align: center; color: #667eea; font-family: 'Fredoka One', cursive; margin-bottom: 15px;">üèÜ Game Scores</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div style="text-align: center; padding: 10px; background: linear-gradient(45deg, #ff6b6b, #ff8e8e); color: white; border-radius: 15px;">
                    <div style="font-weight: bold;">üé® Color Game</div>
                    <div id="dashboard-color-score" style="font-size: 0.9rem;">0/0 (0%) | 0.0s</div>
                </div>
                <div style="text-align: center; padding: 10px; background: linear-gradient(45deg, #4ecdc4, #44a08d); color: white; border-radius: 15px;">
                    <div style="font-weight: bold;">üê∂ Animal Game</div>
                    <div id="dashboard-animal-score" style="font-size: 0.9rem;">0/0 (0%) | 0.0s</div>
                </div>
                <div style="text-align: center; padding: 10px; background: linear-gradient(45deg, #667eea, #764ba2); color: white; border-radius: 15px;">
                    <div style="font-weight: bold;">üß© Memory Game</div>
                    <div id="dashboard-memory-score" style="font-size: 0.9rem;">0/0 (0%) | 0.0s</div>
                </div>
                <div style="text-align: center; padding: 10px; background: linear-gradient(45deg, #f093fb, #f5576c); color: white; border-radius: 15px;">
                    <div style="font-weight: bold;">üî¢ Count Game</div>
                    <div id="dashboard-count-score" style="font-size: 0.9rem;">0/0 (0%) | 0.0s</div>
                </div>
                <div style="text-align: center; padding: 10px; background: linear-gradient(45deg, #ffecd2, #fcb69f); color: #333; border-radius: 15px;">
                    <div style="font-weight: bold;">üëã Gesture Game</div>
                    <div id="dashboard-gesture-score" style="font-size: 0.9rem;">0/0 (0%) | 0.0s</div>
                </div>
            </div>
            <div style="text-align: center; margin-top: 15px;">
                <button onclick="resetAllScores()" style="background: #e74c3c; color: white; border: none; padding: 8px 15px; border-radius: 10px; cursor: pointer; font-family: 'Comic Neue', cursive;">Reset Scores</button>
                <span style="margin: 0 10px; color: #999;">|</span>
                <span style="color: #667eea; font-weight: bold;">üé§ Say "scores" to hear your progress!</span>
            </div>
        </div>
        
        <div class="game-selection">
            <div class="game-card" onclick="startColorGame()">
                <div class="game-icon">üé®</div>
                <h3>Color Learning</h3>
                <p>Learn colors with shapes and voice</p>
                <div class="game-features">
                    <span>üé§ Voice Control</span>
                    <span>üîä Audio Feedback</span>
                    <span>üß† Adaptive Learning</span>
                </div>
            </div>
            
            <div class="game-card" onclick="startGestureGame()">
                <div class="game-icon">üëã</div>
                <h3>Gesture Maestro</h3>
                <p>Learn gestures with camera detection</p>
                <div class="game-features">
                    <span>üìπ Camera Detection</span>
                    <span>‚ú® Visual Feedback</span>
                    <span>üéØ Motion Learning</span>
                </div>
            </div>
            
            <div class="game-card" onclick="startAnimalGame()">
                <div class="game-icon">üê∂</div>
                <h3>Animal Sounds</h3>
                <p>Learn animal sounds and names</p>
                <div class="game-features">
                    <span>üé§ Voice Control</span>
                    <span>üîä Animal Sounds</span>
                    <span>üß† Memory Game</span>
                </div>
            </div>
            
            <div class="game-card" onclick="startMemoryGame()">
                <div class="game-icon">üß©</div>
                <h3>Memory Challenge</h3>
                <p>Remember sequences and patterns</p>
                <div class="game-features">
                    <span>üé§ Voice Control</span>
                    <span>üß† Memory Training</span>
                    <span>üéØ Pattern Recognition</span>
                </div>
            </div>
            
            <div class="game-card" onclick="startCountGame()">
                <div class="game-icon">üî¢</div>
                <h3>QuickCount</h3>
                <p>Count objects by voice</p>
                <div class="game-features">
                    <span>üé§ Voice Control</span>
                    <span>üî¢ Number Learning</span>
                    <span>üëÅÔ∏è Visual Counting</span>
                </div>
            </div>
        </div>
        
        <!-- Color Game Container -->
        <div id="color-game" class="game-container-inner">
            <button class="back-btn" onclick="showGameSelection()">‚Üê Back to Games</button>
            <h2 style="text-align: center; color: #ff6b6b; font-family: 'Fredoka One', cursive;">üé® Color Learning Game</h2>
            
            <div style="text-align: center; margin: 30px 0;">
                <div id="shape-display"></div>
                <p id="question-text" style="font-size: 1.5rem; margin: 20px 0;">Click Start to begin!</p>
            </div>
            
            <div class="color-options">
                <button class="color-btn" data-color="red" style="background-color: #FF0000;"></button>
                <button class="color-btn" data-color="blue" style="background-color: #0000FF;"></button>
                <button class="color-btn" data-color="green" style="background-color: #00FF00;"></button>
                <button class="color-btn" data-color="yellow" style="background-color: #FFFF00;"></button>
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <button id="start-btn" class="control-btn">Start Game</button>
                <button id="repeat-btn" class="control-btn">Repeat Question</button>
            </div>
            
            <div class="feedback">
                <p id="feedback-text" style="text-align: center; font-size: 1.3rem; margin: 20px 0;"></p>
            </div>
            
            <div class="voice-status">
                <p id="voice-status">üé§ Voice ready - say "start" to begin!</p>
                <p style="font-size: 0.9rem; color: #999; margin-top: 5px;">Try: "red", "blue", "green", "yellow", "repeat", "start", "next", "back"</p>
            </div>
        </div>
        
        <!-- Gesture Game Container -->
        <div id="gesture-game" class="game-container-inner">
            <button class="back-btn" onclick="showGameSelection()">‚Üê Back to Games</button>
            <h2 style="text-align: center; color: #4ecdc4; font-family: 'Fredoka One', cursive;">üëã Gesture Maestro</h2>
            
            <div class="camera-container">
                <video id="camera-feed" autoplay muted></video>
                <div class="camera-overlay">
                    <div class="camera-status" id="camera-status">Camera Ready</div>
                </div>
            </div>
            
            <div class="gesture-display">
                <div id="gesture-icon">üëã</div>
                <p id="gesture-instruction" style="font-size: 1.5rem; margin: 10px 0;">Show me a wave!</p>
                <p id="gesture-hint" style="color: #666;">Move your hand like this!</p>
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <button id="start-gesture-btn" class="control-btn">Start Camera</button>
                <button id="next-gesture-btn" class="control-btn">Next Gesture</button>
            </div>
            
            <div class="feedback">
                <p id="gesture-feedback-text" style="text-align: center; font-size: 1.3rem; margin: 20px 0;">Get ready to show gestures!</p>
            </div>
            
            <div class="progress-bar">
                <div id="progress-fill" style="width: 0%;"></div>
            </div>
            <p id="progress-text" style="text-align: center; margin: 10px 0;">0/5 Gestures</p>
            
            <div class="voice-status">
                <p id="gesture-voice-status">üé§ Voice ready - say "start camera" to begin!</p>
                <p style="font-size: 0.9rem; color: #999; margin-top: 5px;">Try: "start", "camera", "next", "back"</p>
            </div>
        </div>
        
        <!-- Animal Game Container -->
        <div id="animal-game" class="game-container-inner">
            <button class="back-btn" onclick="showGameSelection()">‚Üê Back to Games</button>
            <h2 style="text-align: center; color: #ff6b6b; font-family: 'Fredoka One', cursive;">üê∂ Animal Sounds Game</h2>
            
            <div style="text-align: center; margin: 30px 0;">
                <div id="animal-icon">üê∂</div>
                <p id="animal-question" style="font-size: 1.5rem; margin: 20px 0;">Say "start" to begin!</p>
            </div>
            
            <div class="animal-options">
                <button class="animal-btn" data-animal="cat">üê± Cat</button>
                <button class="animal-btn" data-animal="dog">üê∂ Dog</button>
                <button class="animal-btn" data-animal="horse">üê¥ Horse</button>
                <button class="animal-btn" data-animal="duck">ü¶Ü Duck</button>
                <button class="animal-btn" data-animal="rooster">üêì Rooster</button>
                <button class="animal-btn" data-animal="goose">ü¶¢ Goose</button>
                <button class="animal-btn" data-animal="lion">ü¶Å Lion</button>
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <button id="start-animal-btn" class="control-btn">Start Game</button>
                <button id="play-sound-btn" class="control-btn">Play Sound Again</button>
            </div>
            
            <div class="feedback">
                <p id="animal-feedback-text" style="text-align: center; font-size: 1.3rem; margin: 20px 0;">Get ready to listen!</p>
            </div>
            
            <div class="voice-status">
                <p id="animal-voice-status">üé§ Voice ready - say "start" to begin!</p>
                <p style="font-size: 0.9rem; color: #999; margin-top: 5px;">Try: "cat", "dog", "horse", "duck", "rooster", "goose", "lion", "meow", "woof", "neigh", "quack", "repeat", "start", "next", "back"</p>
            </div>
        </div>
        
        <!-- Memory Game Container -->
        <div id="memory-game" class="game-container-inner">
            <button class="back-btn" onclick="showGameSelection()">‚Üê Back to Games</button>
            <h2 style="text-align: center; color: #667eea; font-family: 'Fredoka One', cursive;">üß© Memory Challenge</h2>
            
            <div style="text-align: center; margin: 30px 0;">
                <p id="memory-question" style="font-size: 1.5rem; margin: 20px 0;">Say "start" to begin!</p>
                <div id="memory-display"></div>
                <div id="memory-options"></div>
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <button id="start-memory-btn" class="control-btn">Start Game</button>
                <button id="next-memory-btn" class="control-btn" style="display: none;">Next Question</button>
            </div>
            
            <div class="feedback">
                <p id="memory-feedback-text" style="text-align: center; font-size: 1.3rem; margin: 20px 0;">Get ready to remember!</p>
            </div>
            
            <div class="voice-status">
                <p id="memory-voice-status">üé§ Voice ready - say "start" to begin!</p>
                <p style="font-size: 0.9rem; color: #999; margin-top: 5px;">Try: "apple", "banana", "cat", "dog", "first", "second", "start", "next", "back"</p>
            </div>
        </div>
        
        <!-- Count Game Container -->
        <div id="count-game" class="game-container-inner">
            <button class="back-btn" onclick="showGameSelection()">‚Üê Back to Games</button>
            <h2 style="text-align: center; color: #4ecdc4; font-family: 'Fredoka One', cursive;">üî¢ QuickCount Game</h2>
            
            <div style="text-align: center; margin: 30px 0;">
                <p id="count-question" style="font-size: 1.5rem; margin: 20px 0;">Say "start" to begin!</p>
                <div id="count-display"></div>
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <button id="start-count-btn" class="control-btn">Start Game</button>
                <button id="next-count-btn" class="control-btn" style="display: none;">Next Question</button>
            </div>
            
            <div class="feedback">
                <p id="count-feedback-text" style="text-align: center; font-size: 1.3rem; margin: 20px 0;">Get ready to count!</p>
            </div>
            
            <div class="voice-status">
                <p id="count-voice-status">üé§ Voice ready - say "start" to begin!</p>
                <p style="font-size: 0.9rem; color: #999; margin-top: 5px;">Try: "one", "two", "three", "four", "five", "six", "seven", "eight", "nine", "ten", "start", "next", "back"</p>
            </div>
        </div>
        
        <div class="footer">
            <p>üåü Built for inclusive education - Every child can learn and play! üåü</p>
        </div>
        
        <!-- Floating decorative elements -->
        <div class="floating-shapes">
            <div class="shape shape1">üåü</div>
            <div class="shape shape2">üéà</div>
            <div class="shape shape3">ü¶ã</div>
            <div class="shape shape4">üåà</div>
            <div class="shape shape5">‚≠ê</div>
        </div>
    </div>
    
    <script>
        let currentGame = null;
        let globalRecognition = null;
        let gameActive = false;
        let waitingForNext = false;
        let questionStartTime = 0;
        let gameScores = {};
        let lastCommandTime = 0;
        let commandCooldown = 2000; // 2 second cooldown between commands
        
        const API_BASE = 'http://localhost:3000/api';
        
        const gameData = {
            colors: ['red', 'blue', 'green', 'yellow'],
            animals: [],
            memory: [
                { sequence: ['üçé', 'üçå', 'üçä'], question: 'What was the first fruit?', options: ['üçå Banana', 'üçé Apple', 'üçä Orange', 'üçá Grape'], correct: 1 },
                { sequence: ['üê±', 'üê∂', 'üê†'], question: 'What was in the middle?', options: ['üê± Cat', 'üê∂ Dog', 'üê† Fish', 'üê¶ Bird'], correct: 1 }
            ],
            counting: [
                { object: 'apple', count: 3, icon: 'üçé' },
                { object: 'star', count: 5, icon: '‚≠ê' },
                { object: 'heart', count: 2, icon: '‚ù§Ô∏è' },
                { object: 'circle', count: 4, icon: '‚≠ï' }
            ]
        };
        
        async function requestMicrophoneAccess() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        autoGainControl: true
                    }
                });
                stream.getTracks().forEach(track => track.stop());
                console.log('Microphone access granted');
                return true;
            } catch (error) {
                console.log('Microphone access denied:', error);
                showMicrophoneError();
                return false;
            }
        }
        
        function showMicrophoneError() {
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = `
                position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
                background: #ff4757; color: white; padding: 15px 25px;
                border-radius: 10px; z-index: 1000; font-weight: bold;
                box-shadow: 0 4px 15px rgba(255,71,87,0.3);
            `;
            errorDiv.innerHTML = `
                üé§ Microphone Access Required<br>
                <small>Click the microphone icon in Chrome's address bar and allow access</small>
                <button onclick="this.parentElement.remove()" style="
                    background: white; color: #ff4757; border: none;
                    padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-top: 10px;
                ">Got it!</button>
            `;
            document.body.appendChild(errorDiv);
        }
        
        async function initGlobalVoice() {
            // Always request microphone access first
            const micAccess = await requestMicrophoneAccess();
            if (!micAccess) {
                updateVoiceStatus('üé§ Please allow microphone access for voice commands');
                return;
            }
            
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                globalRecognition = new SpeechRecognition();
                globalRecognition.continuous = true;
                globalRecognition.interimResults = true;
                globalRecognition.lang = 'en-US';
                globalRecognition.maxAlternatives = 5;
                
                // Enhanced settings for slow speech detection
                if (globalRecognition.serviceURI) {
                    globalRecognition.serviceURI = 'wss://www.google.com/speech-api/v2/recognize';
                }
                
                // Set longer timeout for slow speech
                globalRecognition.grammars = new (window.SpeechGrammarList || window.webkitSpeechGrammarList)();
                
                // Adjust for better slow speech recognition
                try {
                    globalRecognition.audioCapture = true;
                    globalRecognition.allowInterimResults = true;
                } catch (e) {
                    console.log('Advanced settings not supported');
                }
                
                let lastProcessedResult = '';
                let resultTimeout = null;
                
                globalRecognition.onresult = (event) => {
                    // Process both interim and final results for slow speech
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const result = event.results[i][0].transcript.toLowerCase().trim();
                        
                        // Skip empty or very short results
                        if (result.length < 2) continue;
                        
                        // Show interim results for feedback
                        if (!event.results[i].isFinal) {
                            updateVoiceStatus(`üé§ Listening: "${result}"`);
                            
                            // Clear previous timeout
                            if (resultTimeout) clearTimeout(resultTimeout);
                            
                            // Set timeout to process slow speech after 1.5 seconds of no new input
                            resultTimeout = setTimeout(() => {
                                if (result !== lastProcessedResult && result.length > 2) {
                                    console.log('Processing slow speech:', result);
                                    lastProcessedResult = result;
                                    updateVoiceStatus(`üé§ Heard: "${result}"`);
                                    handleGlobalVoiceCommand(result);
                                    setTimeout(() => updateVoiceStatus(''), 2000);
                                }
                            }, 1500);
                        } else {
                            // Process final results immediately
                            if (result !== lastProcessedResult) {
                                console.log('Voice heard (final):', result);
                                lastProcessedResult = result;
                                
                                // Clear any pending timeout
                                if (resultTimeout) clearTimeout(resultTimeout);
                                
                                // Show what was heard on screen
                                updateVoiceStatus(`üé§ Heard: "${result}"`);
                                
                                // Process command immediately
                                handleGlobalVoiceCommand(result);
                                setTimeout(() => updateVoiceStatus(''), 2000);
                            }
                        }
                    }
                };
                
                globalRecognition.onend = () => {
                    if (globalRecognition) {
                        // Longer delay for slow speech processing
                        setTimeout(() => {
                            try {
                                if (globalRecognition.state !== 'listening') {
                                    globalRecognition.start();
                                }
                            } catch (e) {
                                console.log('Voice restart error:', e);
                                // Try again after longer delay
                                setTimeout(() => {
                                    try {
                                        globalRecognition.start();
                                    } catch (e2) {
                                        console.log('Voice restart failed:', e2);
                                    }
                                }, 1000);
                            }
                        }, 300);
                    }
                };
                
                globalRecognition.onerror = (event) => {
                    console.log('Voice error:', event.error);
                    
                    if (event.error === 'not-allowed') {
                        showMicrophoneError();
                        return;
                    }
                    
                    // Handle specific errors for slow speech
                    if (event.error === 'no-speech') {
                        // Don't restart immediately for no-speech, wait longer
                        setTimeout(() => {
                            try {
                                if (globalRecognition && globalRecognition.state !== 'listening') {
                                    globalRecognition.start();
                                }
                            } catch (e) {
                                console.log('No-speech restart error:', e);
                            }
                        }, 500);
                    } else if (event.error === 'audio-capture') {
                        updateVoiceStatus('üé§ Microphone issue - please check permissions');
                    } else if (event.error !== 'aborted') {
                        // Restart for other errors
                        setTimeout(() => {
                            try {
                                globalRecognition.start();
                            } catch (e) {
                                console.log('Error restart failed:', e);
                            }
                        }, 1000);
                    }
                };
                
                // Start voice recognition immediately after setup
                try {
                    globalRecognition.start();
                    speak('Welcome to AI Gamify Super Games! Voice commands are ready. You can say game names like color, animal, memory, count, or gesture to start playing.');
                    updateVoiceStatus('üé§ Voice commands active - say a game name!');
                } catch (e) {
                    console.log('Voice start error:', e);
                    updateVoiceStatus('üé§ Voice setup failed - please refresh page');
                }
            } else {
                showBrowserError();
            }
        }
        
        function showBrowserError() {
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = `
                position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
                background: #ff6b6b; color: white; padding: 20px;
                border-radius: 15px; z-index: 1000; max-width: 400px;
                text-align: center; box-shadow: 0 8px 25px rgba(255,107,107,0.3);
            `;
            errorDiv.innerHTML = `
                <h3>üåê Browser Requirements</h3>
                <p>For voice commands to work:</p>
                <ul style="text-align: left; margin: 10px 0;">
                    <li>Use Google Chrome browser</li>
                    <li>Serve from HTTPS or localhost</li>
                    <li>Allow microphone access</li>
                </ul>
                <button onclick="this.parentElement.remove()" style="
                    background: white; color: #ff6b6b; border: none;
                    padding: 8px 15px; border-radius: 5px; cursor: pointer;
                ">Got it!</button>
            `;
            document.body.appendChild(errorDiv);
        }
        
        function updateVoiceStatus(message) {
            const statusElements = [
                document.getElementById('voice-status'),
                document.getElementById('gesture-voice-status'),
                document.getElementById('animal-voice-status'),
                document.getElementById('memory-voice-status'),
                document.getElementById('count-voice-status')
            ];
            
            statusElements.forEach(el => {
                if (el && el.offsetParent !== null) {
                    if (message) {
                        el.textContent = message;
                    } else {
                        // Reset to default message
                        if (currentGame) {
                            el.textContent = `üé§ Voice ready - say commands for ${currentGame} game`;
                        } else {
                            el.textContent = 'üé§ Voice ready - say game name to start';
                        }
                    }
                }
            });
        }
        
        function handleGlobalVoiceCommand(input) {
            const now = Date.now();
            
            // Prevent command repetition with cooldown
            if (now - lastCommandTime < commandCooldown) {
                console.log('Command ignored - cooldown active');
                return;
            }
            
            console.log('Processing command:', input, 'Current game:', currentGame);
            
            const cleanInput = input.toLowerCase().trim();
            
            if (currentGame) {
                handleGameVoiceCommand(input);
            } else {
                // Main menu commands - broader matching for better response
                if (cleanInput.includes('score') || cleanInput.includes('progress')) {
                    lastCommandTime = now;
                    announceScores();
                } else if (cleanInput.includes('reset')) {
                    lastCommandTime = now;
                    resetAllScores();
                } else if (cleanInput.includes('color') || cleanInput.includes('colour')) {
                    lastCommandTime = now;
                    window.speechSynthesis.cancel();
                    speak('Color Game!');
                    setTimeout(() => startColorGame(), 100);
                } else if (cleanInput.includes('gesture')) {
                    lastCommandTime = now;
                    window.speechSynthesis.cancel();
                    speak('Gesture Game!');
                    setTimeout(() => startGestureGame(), 100);
                } else if (cleanInput.includes('animal')) {
                    lastCommandTime = now;
                    window.speechSynthesis.cancel();
                    speak('Animal Game!');
                    setTimeout(() => startAnimalGame(), 100);
                } else if (cleanInput.includes('memory')) {
                    lastCommandTime = now;
                    window.speechSynthesis.cancel();
                    speak('Memory Game!');
                    setTimeout(() => startMemoryGame(), 100);
                } else if (cleanInput.includes('count')) {
                    lastCommandTime = now;
                    window.speechSynthesis.cancel();
                    speak('Count Game!');
                    setTimeout(() => startCountGame(), 100);
                }
            }
        }
        
        function handleGameVoiceCommand(input) {
            const now = Date.now();
            
            console.log('Game command:', input, 'Game active:', gameActive, 'Waiting for next:', waitingForNext);
            
            const cleanInput = input.toLowerCase().trim();
            
            // Back to menu
            if (cleanInput.includes('back') || cleanInput.includes('menu') || cleanInput.includes('home')) {
                if (now - lastCommandTime >= 1000) { // Shorter cooldown for back command
                    lastCommandTime = now;
                    showGameSelection();
                }
                return;
            }
            
            // Start game commands
            if (cleanInput.includes('start') || cleanInput.includes('begin') || cleanInput.includes('play')) {
                if (!gameActive && now - lastCommandTime >= commandCooldown) {
                    lastCommandTime = now;
                    if (currentGame === 'gesture') {
                        document.getElementById('start-gesture-btn').click();
                    } else {
                        const startBtn = document.querySelector(`#start-${currentGame}-btn`) || document.getElementById('start-btn');
                        if (startBtn) startBtn.click();
                    }
                }
                return;
            }
            
            // Next question
            if (cleanInput.includes('next') || cleanInput.includes('continue') || cleanInput.includes('more')) {
                if (waitingForNext && now - lastCommandTime >= 1500) {
                    lastCommandTime = now;
                    waitingForNext = false;
                    if (currentGame === 'color') askColorQuestion();
                    else if (currentGame === 'animal') askAnimalQuestion();
                    else if (currentGame === 'memory') askMemoryQuestion();
                    else if (currentGame === 'count') askCountQuestion();
                    else if (currentGame === 'gesture') {
                        document.getElementById('next-gesture-btn').click();
                    }
                }
                return;
            }
            
            // Repeat commands
            if (cleanInput.includes('repeat') || cleanInput.includes('again')) {
                if (now - lastCommandTime >= 1000) {
                    lastCommandTime = now;
                    if (currentGame === 'color' && currentColorQuestion) {
                        speak('What color is this shape?');
                    } else if (currentGame === 'animal' && currentAnimalQuestion) {
                        playSound(currentAnimalQuestion.sound);
                    } else if (currentGame === 'gesture') {
                        speak(`Show me ${gestures[currentGesture].name}!`);
                    }
                }
                return;
            }
            
            // Game answers
            if (gameActive && now - lastCommandTime >= 1000) {
                handleGameAnswers(cleanInput);
            }
        }
        
        function handleGameAnswers(input) {
            lastCommandTime = Date.now();
            
            if (currentGame === 'color') {
                if (input.includes('red')) handleColorAnswer('red');
                else if (input.includes('blue')) handleColorAnswer('blue');
                else if (input.includes('green')) handleColorAnswer('green');
                else if (input.includes('yellow')) handleColorAnswer('yellow');
            } 
            else if (currentGame === 'animal') {
                if (input.includes('cat') || input.includes('meow')) handleAnimalAnswer('cat');
                else if (input.includes('dog') || input.includes('woof') || input.includes('bark')) handleAnimalAnswer('dog');
                else if (input.includes('horse') || input.includes('neigh')) handleAnimalAnswer('horse');
                else if (input.includes('duck') || input.includes('quack')) handleAnimalAnswer('duck');
                else if (input.includes('rooster') || input.includes('chicken') || input.includes('cock')) handleAnimalAnswer('rooster');
                else if (input.includes('goose') || input.includes('honk')) handleAnimalAnswer('goose');
                else if (input.includes('lion') || input.includes('roar')) handleAnimalAnswer('lion');
            } 
            else if (currentGame === 'memory') {
                const buttons = document.querySelectorAll('.option-btn');
                if (input.includes('apple') || input.includes('first') || input.includes('1')) {
                    if (buttons[0]) buttons[0].click();
                } else if (input.includes('banana') || input.includes('second') || input.includes('2')) {
                    if (buttons[1]) buttons[1].click();
                } else if (input.includes('orange') || input.includes('third') || input.includes('3')) {
                    if (buttons[2]) buttons[2].click();
                } else if (input.includes('grape') || input.includes('fourth') || input.includes('4')) {
                    if (buttons[3]) buttons[3].click();
                } else if (input.includes('cat')) {
                    buttons.forEach(btn => {
                        if (btn.textContent.toLowerCase().includes('cat')) btn.click();
                    });
                } else if (input.includes('dog')) {
                    buttons.forEach(btn => {
                        if (btn.textContent.toLowerCase().includes('dog')) btn.click();
                    });
                }
            } 
            else if (currentGame === 'count') {
                if (input.includes('zero') || input.includes('0')) checkCountAnswer(0);
                else if (input.includes('one') || input.includes('won') || input.includes('1')) checkCountAnswer(1);
                else if (input.includes('two') || input.includes('too') || input.includes('2')) checkCountAnswer(2);
                else if (input.includes('three') || input.includes('tree') || input.includes('3')) checkCountAnswer(3);
                else if (input.includes('four') || input.includes('for') || input.includes('4')) checkCountAnswer(4);
                else if (input.includes('five') || input.includes('5')) checkCountAnswer(5);
                else if (input.includes('six') || input.includes('6')) checkCountAnswer(6);
                else if (input.includes('seven') || input.includes('7')) checkCountAnswer(7);
                else if (input.includes('eight') || input.includes('ate') || input.includes('8')) checkCountAnswer(8);
                else if (input.includes('nine') || input.includes('9')) checkCountAnswer(9);
                else if (input.includes('ten') || input.includes('10')) checkCountAnswer(10);
            }
        }
        

        
        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = 1.5;
            utterance.pitch = 1.0;
            utterance.volume = 0.9;
            window.speechSynthesis.speak(utterance);
        }
        
        // Load animal sounds from local files
        function loadAnimalSounds() {
            gameData.animals = [
                { name: 'cat', sound: 'sounds/cat4.wav', icon: 'üê±' },
                { name: 'dog', sound: 'sounds/dog-bark3.wav', icon: 'üê∂' },
                { name: 'horse', sound: 'sounds/horse3.wav', icon: 'üê¥' },
                { name: 'duck', sound: 'sounds/duck3.wav', icon: 'ü¶Ü' },
                { name: 'rooster', sound: 'sounds/cock1.wav', icon: 'üêì' },
                { name: 'goose', sound: 'sounds/goose1.wav', icon: 'ü¶¢' },
                { name: 'lion', sound: 'sounds/lion1.wav', icon: 'ü¶Å' }
            ];
        }
        
        function getAnimalIcon(animal) {
            const icons = {
                'cat': 'üê±', 'dog': 'üê∂', 'horse': 'üê¥', 'duck': 'ü¶Ü',
                'cock': 'üêì', 'goose': 'ü¶¢', 'lion': 'ü¶Å'
            };
            return icons[animal] || 'üê∂';
        }
        
        async function updateScore(game, correct, responseTime) {
            try {
                await fetch(`${API_BASE}/scores/${game}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ correct, responseTime })
                });
                await loadScores();
            } catch (error) {
                console.log('Score update failed:', error);
            }
        }
        
        async function loadScores() {
            try {
                const response = await fetch(`${API_BASE}/scores`);
                gameScores = await response.json();
                updateScoreDisplay();
            } catch (error) {
                console.log('Score load failed:', error);
            }
        }
        
        function updateScoreDisplay() {
            Object.keys(gameScores).forEach(game => {
                const data = gameScores[game];
                const accuracy = data.totalQuestions > 0 ? 
                    Math.round((data.score / data.totalQuestions) * 100) : 0;
                const avgSpeed = data.avgSpeed > 0 ? (data.avgSpeed / 1000).toFixed(1) : '0.0';
                
                // Update in-game score display
                const scoreEl = document.getElementById(`${game}-score`);
                if (scoreEl) {
                    scoreEl.textContent = `Score: ${data.score}/${data.totalQuestions} (${accuracy}%) | Speed: ${avgSpeed}s`;
                }
                
                // Update dashboard score display
                const dashboardEl = document.getElementById(`dashboard-${game}-score`);
                if (dashboardEl) {
                    dashboardEl.textContent = `${data.score}/${data.totalQuestions} (${accuracy}%) | ${avgSpeed}s`;
                }
            });
        }
        
        async function resetAllScores() {
            try {
                await fetch(`${API_BASE}/reset`, { method: 'POST' });
                await loadScores();
                speak('All scores reset!');
            } catch (error) {
                console.log('Reset failed:', error);
            }
        }
        
        function announceScores() {
            let announcement = 'Your scores: ';
            Object.keys(gameScores).forEach(game => {
                const data = gameScores[game];
                if (data.totalQuestions > 0) {
                    const accuracy = Math.round((data.score / data.totalQuestions) * 100);
                    announcement += `${game} game ${accuracy} percent, `;
                }
            });
            speak(announcement || 'No scores yet. Start playing!');
        }
        
        function startTimer() {
            questionStartTime = Date.now();
        }
        
        function getResponseTime() {
            return questionStartTime > 0 ? Date.now() - questionStartTime : 0;
        }
        
        let currentAudio = null;
        
        function playSound(soundFile) {
            // Stop any currently playing audio
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }
            
            currentAudio = new Audio(soundFile);
            currentAudio.volume = 0.7;
            currentAudio.play().catch(e => {
                console.log('Sound file error:', soundFile, e);
                // Fallback to text-to-speech animal sounds
                const animalSounds = {
                    'sounds/cat4.wav': 'meow meow',
                    'sounds/dog-bark3.wav': 'woof woof bark',
                    'sounds/horse3.wav': 'neigh neigh',
                    'sounds/duck3.wav': 'quack quack',
                    'sounds/cock1.wav': 'cock a doodle doo',
                    'sounds/goose1.wav': 'honk honk',
                    'sounds/lion1.wav': 'roar roar'
                };
                const soundText = animalSounds[soundFile] || 'animal sound';
                speak(soundText);
            });
        }
        
        function startColorGame() {
            currentGame = 'color';
            gameActive = false;
            waitingForNext = false;
            showGame('color-game');
            speak('Color Game ready! Say start.');
        }
        
        function startGestureGame() {
            currentGame = 'gesture';
            gameActive = false;
            waitingForNext = false;
            gestureAttempts = 0;
            gestureDetected = false;
            gestureConfidence = 0;
            
            // Reset gesture to wave
            currentGesture = 'wave';
            document.getElementById('gesture-icon').textContent = 'üëã';
            document.getElementById('gesture-instruction').textContent = 'Show me a wave!';
            document.getElementById('gesture-feedback-text').textContent = 'Get ready to show gestures!';
            document.getElementById('camera-status').textContent = 'Camera Ready';
            document.getElementById('progress-fill').style.width = '0%';
            document.getElementById('progress-text').textContent = '0/5 Gestures';
            
            showGame('gesture-game');
            speak('Gesture Game ready! Say start to begin.');
        }
        
        function startAnimalGame() {
            currentGame = 'animal';
            gameActive = false;
            waitingForNext = false;
            showGame('animal-game');
            speak('Animal Game ready! Say start.');
        }
        
        function startMemoryGame() {
            currentGame = 'memory';
            gameActive = false;
            waitingForNext = false;
            showGame('memory-game');
            speak('Memory Game ready! Say start.');
        }
        
        function startCountGame() {
            currentGame = 'count';
            gameActive = false;
            waitingForNext = false;
            showGame('count-game');
            speak('Count Game ready! Say start.');
        }
        
        function showGame(gameId) {
            document.querySelector('.game-selection').style.display = 'none';
            document.querySelector('.description').style.display = 'none';
            document.getElementById(gameId).style.display = 'block';
        }
        
        function showGameSelection() {
            // Stop all audio and speech immediately
            window.speechSynthesis.cancel();
            
            // Stop any playing audio elements
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
                currentAudio = null;
            }
            
            currentGame = null;
            gameActive = false;
            waitingForNext = false;
            currentColorQuestion = null;
            currentAnimalQuestion = null;
            currentMemoryQuestion = null;
            currentCountQuestion = null;
            
            // Stop gesture detection
            if (typeof gestureInterval !== 'undefined') {
                clearInterval(gestureInterval);
            }
            
            document.querySelectorAll('.game-container-inner').forEach(el => el.style.display = 'none');
            document.querySelector('.game-selection').style.display = 'grid';
            document.querySelector('.description').style.display = 'block';
            
            // Ensure voice recognition is still running
            if (globalRecognition && globalRecognition.state === 'inactive') {
                try {
                    globalRecognition.start();
                } catch (e) {
                    console.log('Voice restart after menu return:', e);
                }
            }
            
            // Brief delay then speak menu message
            setTimeout(() => {
                speak('Main menu. Say a game name.');
            }, 300);
        }
        
        let currentColorQuestion = null;
        let currentAnimalQuestion = null;
        let currentMemoryQuestion = null;
        let currentCountQuestion = null;
        
        function askColorQuestion() {
            const color = gameData.colors[Math.floor(Math.random() * gameData.colors.length)];
            currentColorQuestion = color;
            
            const shapeDisplay = document.getElementById('shape-display');
            const colorMap = { 'red': '#FF0000', 'blue': '#0000FF', 'green': '#00FF00', 'yellow': '#FFFF00' };
            
            shapeDisplay.style.cssText = `
                width: 150px; height: 150px; margin: 0 auto;
                background-color: ${colorMap[color]};
                border-radius: 50%; border: 4px solid white;
                box-shadow: 0 0 30px rgba(255,255,255,0.5);
            `;
            
            document.getElementById('question-text').textContent = 'What color is this shape?';
            document.getElementById('feedback-text').textContent = '';
            speak('What color is this shape?');
            startTimer();
        }
        
        function handleColorAnswer(selectedColor) {
            const responseTime = getResponseTime();
            const correct = selectedColor === currentColorQuestion;
            
            if (correct) {
                document.getElementById('feedback-text').textContent = 'üéâ Correct! Amazing!';
                document.getElementById('feedback-text').className = 'success';
                speak('Correct! Amazing! Say next for another question.');
                waitingForNext = true;
                updateScore('color', true, responseTime);
            } else {
                document.getElementById('feedback-text').textContent = '‚ùå Try again!';
                document.getElementById('feedback-text').className = 'error';
                speak('Try again!');
                updateScore('color', false, responseTime);
            }
        }
        
        function askAnimalQuestion() {
            if (gameData.animals.length === 0) {
                speak('Loading animals...');
                return;
            }
            const animal = gameData.animals[Math.floor(Math.random() * gameData.animals.length)];
            currentAnimalQuestion = animal;
            
            document.getElementById('animal-icon').textContent = 'üîä';
            document.getElementById('animal-question').textContent = 'Listen and guess the animal!';
            document.getElementById('animal-feedback-text').textContent = '';
            
            playSound(animal.sound);
            speak('What animal?');
            startTimer();
        }
        
        function handleAnimalAnswer(selectedAnimal) {
            const responseTime = getResponseTime();
            const correct = selectedAnimal === currentAnimalQuestion.name;
            
            if (correct) {
                document.getElementById('animal-icon').textContent = currentAnimalQuestion.icon;
                document.getElementById('animal-feedback-text').textContent = 'üéâ Perfect!';
                document.getElementById('animal-feedback-text').className = 'success';
                speak('Perfect! Say next.');
                waitingForNext = true;
                updateScore('animal', true, responseTime);
            } else {
                document.getElementById('animal-feedback-text').textContent = '‚ùå Try again!';
                document.getElementById('animal-feedback-text').className = 'error';
                speak('Try again!');
                updateScore('animal', false, responseTime);
            }
        }
        
        function askMemoryQuestion() {
            const question = gameData.memory[Math.floor(Math.random() * gameData.memory.length)];
            currentMemoryQuestion = question;
            
            document.getElementById('memory-question').textContent = 'Remember this sequence:';
            const display = document.getElementById('memory-display');
            display.innerHTML = question.sequence.map(item => 
                `<span style="font-size: 3rem; margin: 10px; padding: 20px; background: white; border-radius: 15px; display: inline-block;">${item}</span>`
            ).join('');
            
            speak('Remember this.');
            startTimer();
            
            setTimeout(() => {
                document.getElementById('memory-question').textContent = question.question;
                display.innerHTML = '';
                
                const options = document.getElementById('memory-options');
                options.innerHTML = question.options.map((option, index) => 
                    `<button class="option-btn" onclick="handleMemoryAnswer(${index})">${option}</button>`
                ).join('');
                
                speak(question.question.replace('What was ', ''));
            }, 2500);
        }
        
        function handleMemoryAnswer(selectedIndex) {
            const responseTime = getResponseTime();
            const correct = selectedIndex === currentMemoryQuestion.correct;
            
            if (correct) {
                document.getElementById('memory-feedback-text').textContent = 'üéâ Excellent!';
                document.getElementById('memory-feedback-text').className = 'success';
                speak('Excellent! Say next.');
                waitingForNext = true;
                updateScore('memory', true, responseTime);
            } else {
                document.getElementById('memory-feedback-text').textContent = '‚ùå Try again!';
                document.getElementById('memory-feedback-text').className = 'error';
                speak('Try again!');
                updateScore('memory', false, responseTime);
            }
        }
        
        function askCountQuestion() {
            const question = gameData.counting[Math.floor(Math.random() * gameData.counting.length)];
            currentCountQuestion = question;
            
            document.getElementById('count-question').textContent = `How many ${question.object}s?`;
            
            const display = document.getElementById('count-display');
            display.innerHTML = Array(question.count).fill(0).map(() => 
                `<span style="font-size: 4rem; margin: 15px; display: inline-block;">${question.icon}</span>`
            ).join('');
            
            speak(`How many ${question.object}s?`);
            startTimer();
        }
        
        function checkCountAnswer(answer) {
            const responseTime = getResponseTime();
            const correct = answer === currentCountQuestion.count;
            
            if (correct) {
                document.getElementById('count-feedback-text').textContent = `üéâ Correct! ${currentCountQuestion.count}!`;
                document.getElementById('count-feedback-text').className = 'success';
                speak(`Correct! ${currentCountQuestion.count}! Say next.`);
                waitingForNext = true;
                updateScore('count', true, responseTime);
            } else {
                document.getElementById('count-feedback-text').textContent = '‚ùå Try again!';
                document.getElementById('count-feedback-text').className = 'error';
                speak('Try again!');
                updateScore('count', false, responseTime);
            }
        }
        
        document.addEventListener('DOMContentLoaded', async () => {
            // Initialize backend data
            loadAnimalSounds();
            loadScores();
            
            // Always initialize voice on page load
            await initGlobalVoice();
            
            // Ensure voice stays active - restart if needed
            setInterval(() => {
                if (globalRecognition && globalRecognition.state === 'inactive') {
                    try {
                        globalRecognition.start();
                    } catch (e) {
                        console.log('Voice keepalive restart:', e);
                    }
                }
            }, 5000);
            
            // Color Game Event Listeners
            document.getElementById('start-btn').addEventListener('click', () => {
                if (!gameActive) {
                    gameActive = true;
                    speak('Starting Color Game!');
                    askColorQuestion();
                }
            });
            
            document.getElementById('repeat-btn').addEventListener('click', () => {
                if (currentColorQuestion) {
                    speak('What color is this shape?');
                }
            });
            
            document.querySelectorAll('.color-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (gameActive) {
                        speak(`You clicked ${btn.dataset.color}`);
                        handleColorAnswer(btn.dataset.color);
                    }
                });
            });
            
            // Animal Game Event Listeners
            document.getElementById('start-animal-btn').addEventListener('click', () => {
                if (!gameActive) {
                    gameActive = true;
                    speak('Starting Animal Game!');
                    askAnimalQuestion();
                }
            });
            
            document.getElementById('play-sound-btn').addEventListener('click', () => {
                if (currentAnimalQuestion) {
                    speak('Playing animal sound again');
                    playSound(currentAnimalQuestion.sound);
                }
            });
            
            document.querySelectorAll('.animal-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (gameActive) {
                        speak(`You clicked ${btn.dataset.animal}`);
                        handleAnimalAnswer(btn.dataset.animal);
                    }
                });
            });
            
            // Memory Game Event Listeners
            document.getElementById('start-memory-btn').addEventListener('click', () => {
                if (!gameActive) {
                    gameActive = true;
                    speak('Starting Memory Game!');
                    askMemoryQuestion();
                }
            });
            
            document.getElementById('next-memory-btn').addEventListener('click', () => {
                waitingForNext = false;
                speak('Next memory question!');
                askMemoryQuestion();
            });
            
            // Count Game Event Listeners
            document.getElementById('start-count-btn').addEventListener('click', () => {
                if (!gameActive) {
                    gameActive = true;
                    speak('Starting Count Game!');
                    askCountQuestion();
                }
            });
            
            document.getElementById('next-count-btn').addEventListener('click', () => {
                waitingForNext = false;
                speak('Next counting question!');
                askCountQuestion();
            });
            
            let gestureInterval;
            let currentGesture = 'wave';
            let gestureAttempts = 0;
            let hands, camera;
            let gestureDetected = false;
            let gestureConfidence = 0;
            let lastGestureTime = 0;
            
            const gestures = {
                'wave': { icon: 'üëã', name: 'Wave' },
                'thumbs_up': { icon: 'üëç', name: 'Thumbs Up' },
                'peace': { icon: '‚úåÔ∏è', name: 'Peace Sign' },
                'fist': { icon: '‚úä', name: 'Fist' }
            };
            
            function detectGesture(landmarks) {
                if (!landmarks || landmarks.length === 0) return null;
                
                const hand = landmarks[0];
                
                // Get key points
                const thumbTip = hand[4];
                const thumbIP = hand[3];
                const indexTip = hand[8];
                const indexPIP = hand[6];
                const middleTip = hand[12];
                const middlePIP = hand[10];
                const ringTip = hand[16];
                const ringPIP = hand[14];
                const pinkyTip = hand[20];
                const pinkyPIP = hand[18];
                const wrist = hand[0];
                
                // Calculate if fingers are extended (more reliable)
                const thumbUp = thumbTip.y < thumbIP.y - 0.02;
                const indexUp = indexTip.y < indexPIP.y - 0.02;
                const middleUp = middleTip.y < middlePIP.y - 0.02;
                const ringUp = ringTip.y < ringPIP.y - 0.02;
                const pinkyUp = pinkyTip.y < pinkyPIP.y - 0.02;
                
                // Count extended fingers
                const extendedCount = [indexUp, middleUp, ringUp, pinkyUp].filter(Boolean).length;
                
                // Improved gesture detection
                if (indexUp && middleUp && !ringUp && !pinkyUp && !thumbUp) {
                    return 'peace';
                } else if (thumbUp && !indexUp && !middleUp && !ringUp && !pinkyUp) {
                    return 'thumbs_up';
                } else if (indexUp && !middleUp && !ringUp && !pinkyUp) {
                    return 'wave';
                } else if (extendedCount === 0 && !thumbUp) {
                    return 'fist';
                }
                
                return null;
            }
            
            function onResults(results) {
                if (!gameActive || waitingForNext) return;
                
                const now = Date.now();
                if (now - lastGestureTime < 1000) return; // Prevent rapid detection
                
                if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                    const detectedGesture = detectGesture(results.multiHandLandmarks);
                    
                    if (detectedGesture === currentGesture) {
                        gestureConfidence++;
                        
                        // Require 3 consecutive detections for confirmation
                        if (gestureConfidence >= 3 && !gestureDetected) {
                            gestureDetected = true;
                            lastGestureTime = now;
                            
                            document.getElementById('gesture-feedback-text').textContent = 'üéâ Perfect gesture!';
                            document.getElementById('gesture-feedback-text').className = 'success';
                            document.getElementById('camera-status').textContent = 'Gesture Recognized!';
                            
                            speak('Perfect! Say next for another gesture.');
                            waitingForNext = true;
                            updateScore('gesture', true, getResponseTime());
                            
                            // Update progress
                            const progress = Math.min(100, ((gestureAttempts + 1) / 5) * 100);
                            document.getElementById('progress-fill').style.width = progress + '%';
                            document.getElementById('progress-text').textContent = `${gestureAttempts + 1}/5 Gestures`;
                        }
                    } else {
                        gestureConfidence = Math.max(0, gestureConfidence - 1);
                    }
                    
                    // Show current detection status
                    if (detectedGesture && !gestureDetected) {
                        document.getElementById('camera-status').textContent = 
                            detectedGesture === currentGesture ? 
                            `Good! Hold ${gestures[currentGesture].name}...` : 
                            `Detected: ${detectedGesture}. Show ${gestures[currentGesture].name}`;
                    }
                } else {
                    gestureConfidence = Math.max(0, gestureConfidence - 1);
                    if (!gestureDetected) {
                        document.getElementById('camera-status').textContent = 'Show your hand to the camera';
                    }
                }
            }
            
            document.getElementById('start-gesture-btn').addEventListener('click', async () => {
                if (!gameActive) {
                    try {
                        document.getElementById('camera-status').textContent = 'Loading camera...';
                        
                        // Request camera access first
                        const stream = await navigator.mediaDevices.getUserMedia({ 
                            video: { width: 640, height: 480 } 
                        });
                        
                        const videoElement = document.getElementById('camera-feed');
                        videoElement.srcObject = stream;
                        
                        // Wait for video to load
                        await new Promise(resolve => {
                            videoElement.onloadedmetadata = resolve;
                        });
                        
                        // Load MediaPipe Hands
                        if (!hands) {
                            hands = new Hands({
                                locateFile: (file) => {
                                    return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
                                }
                            });
                            hands.setOptions({
                                maxNumHands: 1,
                                modelComplexity: 0,
                                minDetectionConfidence: 0.7,
                                minTrackingConfidence: 0.5
                            });
                            hands.onResults(onResults);
                        }
                        
                        if (!camera) {
                            camera = new Camera(videoElement, {
                                onFrame: async () => {
                                    if (hands) await hands.send({ image: videoElement });
                                },
                                width: 640,
                                height: 480
                            });
                        }
                        
                        camera.start();
                        
                        gameActive = true;
                        gestureAttempts = 0;
                        gestureDetected = false;
                        gestureConfidence = 0;
                        
                        document.getElementById('camera-status').textContent = `Show ${gestures[currentGesture].name} gesture`;
                        document.getElementById('gesture-feedback-text').textContent = 'Get ready!';
                        
                        startTimer();
                        speak(`Camera ready! Show me ${gestures[currentGesture].name}!`);
                        
                    } catch (error) {
                        console.error('Camera error:', error);
                        document.getElementById('camera-status').textContent = 'Camera access denied';
                        speak('Camera access failed. Please allow camera access and try again.');
                    }
                }
            });
            
            // Gesture Game Next Button
            document.getElementById('next-gesture-btn').addEventListener('click', () => {
                if (!waitingForNext) return;
                
                gestureAttempts++;
                
                if (gestureAttempts >= 5) {
                    // Game complete
                    document.getElementById('gesture-feedback-text').textContent = 'üéâ All gestures complete!';
                    document.getElementById('camera-status').textContent = 'Game Complete!';
                    speak('Excellent! You completed all gestures! Say start to play again.');
                    gameActive = false;
                    waitingForNext = false;
                    return;
                }
                
                const gestureKeys = Object.keys(gestures);
                currentGesture = gestureKeys[Math.floor(Math.random() * gestureKeys.length)];
                const gesture = gestures[currentGesture];
                
                document.getElementById('gesture-icon').textContent = gesture.icon;
                document.getElementById('gesture-instruction').textContent = `Show me: ${gesture.name}!`;
                document.getElementById('gesture-feedback-text').textContent = 'Get ready!';
                document.getElementById('gesture-feedback-text').className = '';
                document.getElementById('camera-status').textContent = `Show ${gesture.name} gesture`;
                
                waitingForNext = false;
                gestureDetected = false;
                gestureConfidence = 0;
                
                startTimer();
                speak(`Show me ${gesture.name}!`);
            });
            
            // Back buttons for all games
            document.querySelectorAll('.back-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    showGameSelection();
                });
            });
        });
    </script>